<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			 xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
				http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
				http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.0.xsd">
<!-- Application context definition for Search Dispatcher Servlet -->
	
	<!--  Define how the dispatcher will select the controllers -->
	<bean id="urlMapping" class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="interceptors">
			<list>
				<ref bean="localeChangeInterceptor"/>
				<ref bean="dataAgreementInterceptor"/>
                <ref bean="sessionHistoryInterceptor"/>
			</list>
		</property>
		<property name="mappings">
			<props>
				<prop key="blanketSearch.htm">blanketQueryController</prop>
                <prop key="/scientificNames/**/*">scientificNameSearchController</prop>
                <prop key="/commonNames/**/*">commonNameSearchController</prop>
                <prop key="/geoRegions/**/*">geoRegionSearchController</prop>
                <prop key="/localities/**/*">localitySearchController</prop>
                <prop key="/dataResources/**/*">dataResourceSearchController</prop>
                <prop key="/dataProviders/**/*">dataProviderSearchController</prop>
                <prop key="/institutions/**/*">institutionSearchController</prop>
				<prop key="/*">searchController</prop>
				<prop key="/">redirectToRootController</prop>
			</props>
		</property>
	</bean>

    <bean id="searchController" class="org.ala.web.controller.InitialSearchController">
        <property name="sessionFactory" ref="hsSessionFactory"/>
        <property name="urlRoot" value="/search/"/>
        <property name="supportedPatterns">
            <list>
                <list>
                    <value>searchString</value>
                </list>
                <list>
                    <value>searchString</value>
                    <value>view</value>
                </list>
                <list>
                    <value>searchString</value>
                    <value>view</value>
                    <value>startIndex</value>
                </list>
            </list>
        </property>
    </bean>

    <bean id="abstractSearchController" abstract="true" class="org.ala.web.controller.PagingSearchController">
        <property name="sessionFactory" ref="hsSessionFactory"/>
        <property name="urlRoot" value="search"/>
        <property name="supportedPatterns">
            <list>
                <list>
                    <value>searchType</value>
                    <value>searchString</value>
                </list>
                <list>
                    <value>searchType</value>
                    <value>searchString</value>
                    <value>view</value>
                </list>
            </list>
        </property>
    </bean>

    <!-- Controller for scientific name fulltext search results -->
    <bean id="scientificNameSearchController" parent="abstractSearchController">
        <property name="searchType" value="SCIENTIFIC_NAMES"/>
        <property name="htmlView" value="scientificNamesSearchView"/>
        <property name="jsonView" value="scientificNamesJsonView"/>
        <property name="sortFieldMap">
            <map>
                <entry key="scientificName" value="taxonName.canonicalForSort"/>
                <entry key="kingdom" value="kingdomConcept.taxonName.canonical"/>
            </map>
        </property>
    </bean>
    
    <!-- Controller for common name fulltext search results -->
    <bean id="commonNameSearchController" parent="abstractSearchController">
        <property name="searchType" value="COMMON_NAMES"/>
        <property name="htmlView" value="commonNamesSearchView"/>
        <property name="jsonView" value="commonNamesJsonView"/>
        <property name="sortFieldMap">
            <map>
                <entry key="scientificName" value="taxonConcept.taxonName.canonical"/>
                <entry key="commonName" value="nameForSort"/>
                <entry key="kingdom" value="kingdomConcept.taxonName.canonical"/>
            </map>
        </property>
    </bean>

    <!-- Controller for geo region fulltext search results -->
    <bean id="geoRegionSearchController" parent="abstractSearchController">
        <property name="searchType" value="GEOGRAPHIC_REGIONS"/>
        <property name="htmlView" value="geoRegionsSearchView"/>
        <property name="jsonView" value="geoRegionsJsonView"/>
        <property name="sortFieldMap">
            <map>
                <entry key="geoRegion" value="nameForSort"/>
            </map>
        </property>
    </bean>

    <!-- Controller for locality fulltext search results -->
    <bean id="localitySearchController" parent="abstractSearchController">
        <property name="searchType" value="LOCALITIES"/>
        <property name="htmlView" value="localitiesSearchView"/>
        <property name="jsonView" value="localitiesJsonView"/>
        <property name="sortFieldMap">
            <map>
                <entry key="locality" value="nameForSort"/>
            </map>
        </property>
    </bean>

    <!-- Controller for data resource fulltext search results -->
    <bean id="dataResourceSearchController" parent="abstractSearchController">
        <property name="searchType" value="DATA_RESOURCES"/>
        <property name="htmlView" value="dataResourcesSearchView"/>
        <property name="jsonView" value="dataResourcesJsonView"/>
        <property name="sortFieldMap">
            <map>
                <entry key="dataResource" value="nameForSort"/>
                <entry key="occurrences" value="occurrenceCount"/>
            </map>
        </property>
    </bean>

    <!-- Controller for data provider fulltext search results -->
    <bean id="dataProviderSearchController" parent="abstractSearchController">
        <property name="searchType" value="DATA_PROVIDERS"/>
        <property name="htmlView" value="dataProvidersSearchView"/>
        <property name="jsonView" value="dataProvidersJsonView"/>
        <property name="sortFieldMap">
            <map>
                <entry key="dataProvider" value="nameForSort"/>
                <entry key="occurrences" value="occurrenceCount"/>
            </map>
        </property>
    </bean>

    <!-- Controller for institution fulltext search results -->
    <bean id="institutionSearchController" parent="abstractSearchController">
        <property name="searchType" value="INSTITUTIONS"/>
        <property name="htmlView" value="institutionsSearchView"/>
        <property name="jsonView" value="institutionsJsonView"/>
        <property name="sortFieldMap">
            <map>
                <entry key="name" value="nameForSort"/>
            </map>
        </property>
    </bean>

	<!-- Controller for the initial Blanket Query -->
	<bean id="blanketQueryController" class="org.gbif.portal.web.controller.RedirectToRestUrlController">
		<property name="redirectRootUrl" value="/search/"/>
		<property name="requestParamName" value="keyword"/>
		<property name="supportWildcardSubstitution" value="true"/>
		<property name="supportedWildcards" value="%,*"/>
		<property name="wildcard" value="*"/>
		<property name="whitespace2Underscores" value="false"/>		
		<property name="decodeArgument" value="false"/>				
	</bean>

	<!-- Just redirect to root if no parameters are supplied -->
	<bean id="redirectToRootController" class="org.gbif.portal.web.controller.RedirectToRestUrlController">
		<property name="redirectRootUrl" value="/"/>
		<property name="requestParamName" value="keyword"/>
		<property name="supportWildcardSubstitution" value="true"/>
		<property name="supportedWildcards" value="%,*"/>
		<property name="wildcard" value="*"/>
	</bean>	

	<!-- Controller for the initial Blanket Query -->
	<bean id="simpleQueryController" class="org.gbif.portal.web.controller.RestController">
		<property name="urlRoot" value="search"/>
		<property name="viewNamePrefix" value="search"/>
		<property name="supportedSubViews">
			<list>
				<value>taxa</value>
				<value>commonNames</value>
				<value>countries</value>
				<value>datasets</value>
				<value>taxaList</value>
				<value>commonNamesList</value>
				<value>countriesList</value>
				<value>datasetsList</value>
			</list>
		</property>
		<property name="supportedPatterns">
			<list>
				<list>
					<value>searchString</value>
				</list>
				<list>
					<value>searchString</value>
					<value>view</value>
				</list>
				<list>
					<value>searchString</value>
					<value>view</value>
					<value>startIndex</value>
				</list>
			</list>
		</property>
	</bean>	
	
	<!-- Taxa search -->
	<bean id="taxonSearchController" class="org.gbif.portal.web.controller.search.TaxonSearchController">
		<property name="urlRoot" value="taxa"/>
		<property name="viewNamePrefix" value="search.taxa.full"/>
		<property name="taxonomyManager" ref="taxonomyManager"/>
		<property name="dataResourceManager" ref="dataResourceManager"/>
		<property name="supportedPatterns" ref="searchSupportedPatterns"/>		
	</bean>	
	<!-- Common name search -->
	<bean id="commonNamesSearchController" class="org.gbif.portal.web.controller.search.CommonNameSearchController">
		<property name="urlRoot" value="commonNames"/>
		<property name="viewNamePrefix" value="search.commonNames.full"/>
		<property name="taxonomyManager" ref="taxonomyManager"/>
		<property name="dataResourceManager" ref="dataResourceManager"/>
		<property name="supportedPatterns" ref="searchSupportedPatterns"/>
	</bean>	
	<!-- Countries search -->
	<bean id="countriesSearchController" class="org.gbif.portal.web.controller.search.CountriesSearchController">
		<property name="urlRoot" value="countries"/>
		<property name="viewNamePrefix" value="search.countries.full"/>
		<property name="geospatialManager" ref="geospatialManager"/>
		<property name="supportedPatterns" ref="searchSupportedPatterns"/>
	</bean>	
	<!-- Dataset search -->
	<bean id="datasetsSearchController" class="org.gbif.portal.web.controller.search.DatasetSearchController">
		<property name="urlRoot" value="datasets"/>
		<property name="viewNamePrefix" value="search.datasets.full"/>
		<property name="dataResourceManager" ref="dataResourceManager"/>
		<property name="supportedPatterns" ref="searchSupportedPatterns"/>
	</bean>	
	<!-- Supported pattern list for simple search and paging -->
	<util:list id="searchSupportedPatterns">
			<list>
				<value>searchString</value>
			</list>
			<list>
				<value>searchString</value>
				<value>pageNo</value>
			</list>
			<list>
				<value>searchString</value>
				<value>pageNo</value>
				<value>highWaterMark</value>
			</list>				
	</util:list>
</beans>